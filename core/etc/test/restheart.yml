# RESTHeart Configuration File for Integration Tests.
# Used by `mvn clean verify`
## See https://restheart.org/docs/setup/#configuration-files

---
instance-name: integration-test

http-listener:
  enabled: true
  host: 0.0.0.0
  port: 8080

# Authentication Mechanisms

tokenBasicAuthMechanism:
  enabled: true

basicAuthMechanism:
  enabled: true
  authenticator: fileRealmAuthenticator

digestAuthMechanism:
  enabled: true
  realm: RESTHeart Realm
  domain: localhost
  authenticator: fileRealmAuthenticator

identityAuthMechanism:
  enabled: false
  username: admin
  roles:
    - admin
    - user

jwtAuthenticationMechanism:
  enabled: true
  algorithm: HS256
  key: secret
  base64Encoded: false
  usernameClaim: sub
  rolesClaim: roles
  fixedRoles:
  #  - admin
  issuer: myIssuer
  audience: myAudience

# Authenticators

fileRealmAuthenticator:
  enabled: true
  conf-file: ./users.yml

mongoRealmAuthenticator:
  users-db: restheart-test
  users-collection: users
  prop-id: _id
  prop-password: password
  json-path-roles: $.roles
  bcrypt-hashed-password: true
  bcrypt-complexity: 12
  enforce-minimum-password-strenght: false
  # Integer from 0 to 4
  # 0 Weak        （guesses < 3^10）
  # 1 Fair        （guesses < 6^10）
  # 2 Good        （guesses < 8^10）
  # 3 Strong      （guesses < 10^10）
  # 4 Very strong （guesses >= 10^10）
  minimum-password-strength: 3
  create-user: true
  create-user-document: '{"_id": "admin", "password": "secret", "roles": ["admin"]}'
  cache-enabled: false
  cache-size: 1000
  cache-ttl: 60000
  cache-expire-policy: AFTER_WRITE

## Authorizers

fileAclAuthorizer:
  enabled: true
  conf-file: ./acl.yml

mongoAclAuthorizer:
  acl-db: restheart-test
  acl-collection: acl
  root-role: admin
  cache-enabled: false
  cache-size: 1000
  cache-ttl: 5000
  cache-expire-policy: AFTER_WRITE

fullAuthorizer:
  enabled: false
  authentication-required: true

# Token Managers

rndTokenManager:
  enabled: true
  ttl: 15
  srv-uri: /tokens

jwtTokenManager:
    enabled: false
    key: secret
    ttl: 15
    srv-uri: /tokens
    issuer: restheart.org

mongo-uri: mongodb://127.0.0.1

plugins-directory: plugins

mongo:
  uri: /
  mongo-mounts:
    - what: '*'
      where: /
    - what: '*'
      where: /remappedall
    - what: /testdb
      where: /remappeddb
    - what: /testdb/refcoll1
      where: /remappedrefcoll1
    - what: /testdb/refcoll2
      where: /remappedrefcoll2
    - what: /testdb/refcoll1/doc1
      where: /remappeddoc1
    - what: /testdb/refcoll2/doc2
      where: /remappeddoc2
  default-representation-format: HAL
  etag-check-policy:
    db: REQUIRED_FOR_DELETE
    coll: REQUIRED_FOR_DELETE
    doc: OPTIONAL
  aggregation-check-operators: true
  default-pagesize: 100
  max-pagesize: 1000
  local-cache-enabled: true
  local-cache-ttl: 60000
  schema-cache-enabled: true
  schema-cache-ttl: 60000
  query-time-limit: 0
  aggregation-time-limit: 0

graphql:
  uri: /graphql
  db: test-graphql
  collection: gql-apps
  verbose: true

proxies:
 - location: /pecho
   proxy-pass: http://127.0.0.1:8080/echo
 - location: /piecho
   proxy-pass: http://127.0.0.1:8080/iecho
 - location: /anything
   proxy-pass: https://httpbin.org/anything

static-resources:
#  - what: /path/to/resources
#    where: /static
#    welcome-file: index.html
#    embedded: false

filterOperatorsBlacklist:
  blacklist: [ "$where" ]
  enabled: true

bruteForceAttackGuard:
  enabled: false
  trust-x-forwarded-for: false
  max-failed-attempts: 5

testInitializer:
    enabled: true

authTokenService:
    uri: /tokens

ping:
    msg: 'Ping!'

roles:
    uri: /roles

echo:
    uri: /echo

secho:
    uri: /secho
    enabled: true

iecho:
    uri: /iecho
    enabled: true

echoRequestInterceptor:
    enabled: true

echoResponseInterceptor:
    enabled: true

echoAsyncResponseInterceptor:
    enabled: true

echoProxyRequestInterceptor:
    enabled: true

echoProxyResponseInterceptor:
    enabled: true

secretHider:
    enabled: true

logMessageInitializer:
    enabled: false
    message: Hello World!
    log-level: INFO

addBodyToWriteResponsesInitializer:
    enabled: false

snooper:
    enabled: true

writeResult:
    enabled: true

allow-unescaped-characters-in-url: true

# Logging
enable-log-file: true
log-file-path: /var/log/restheart.log
enable-log-console: true
log-level: DEBUG
ansi-console: true
requests-log-level: 1
metrics-gathering-level: DATABASE
requests-log-trace-headers:

# Performace Settings
force-gzip-encoding: false
requests-limit: 1000
io-threads: 4
worker-threads: 8
buffer-size: 16384
direct-buffers: true

# Connection Options
connection-options:
  MAX_HEADER_SIZE: 1048576
  MAX_ENTITY_SIZE: -1
  MULTIPART_MAX_ENTITY_SIZE: -1
  IDLE_TIMEOUT: -1
  REQUEST_PARSE_TIMEOUT: -1
  NO_REQUEST_TIMEOUT: -1
  MAX_PARAMETERS: 1000
  MAX_HEADERS: 200
  MAX_COOKIES: 200
  URL_CHARSET: UTF-8
  ALWAYS_SET_KEEP_ALIVE: true
  ALWAYS_SET_DATE: true
